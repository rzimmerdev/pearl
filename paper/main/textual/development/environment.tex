%! Author = rzimmerdev
%! Date = 3/28/25

% Preamble
\documentclass[11pt]{article}

% Packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{amssymb}

% Document
\begin{document}
    \subsection{Simulated Trading Environment and Limit Order Book Dynamics}
    \label{subsec:environment}
    The simulated environment is designed to replicate key aspects of a modern financial market by incorporating a limit order book (LOB) mechanism.
    A LOB is the core structure in many electronic trading systems, where buy and sell orders are organized by price and time priority,
    thereby reflecting the real-time supply and demand of an asset.

    In this environment, agents interact with the market by submitting orders that represent their actions.
    Specifically, each action corresponds to placing a limit order—a directive to buy or sell a specified quantity at a predetermined price.
    When an agent submits an order, it is added to the appropriate side of the LOB, where orders are queued according to their price and
    the time at which they were submitted.
    An order is executed if there is a matching order on the opposite side of the book that satisfies the price condition;
    otherwise, it remains in the book until a suitable counter-order appears or the order is cancelled by the agent.
    This event-driven process mimics the intricate dynamics of order matching observed in real markets.

    The simulation employs a discrete-event framework to model these processes accurately.
    At each simulation step, the environment generates an observation that includes critical details such as the best bid and ask prices,
    the order book depth across various price levels, and records of recent trade executions.
    These observations are then provided to the agents, enabling them to update their strategies based on the evolving market state.

    Order submission and execution in the simulated environment are handled asynchronously.
    Agents send their orders via a messaging layer—implemented with a high-performance protocol like
    ZeroMQ—to ensure that multiple agents can interact with the shared LOB concurrently without incurring significant delays.
    This asynchronous architecture not only improves simulation throughput but also closely aligns with
    the latency-sensitive nature of high-frequency trading environments.

    By integrating a realistic LOB into the simulation, the environment provides a robust testbed for exploring how
    distributed reinforcement learning algorithms can learn and adapt in complex, dynamic markets.
    The detailed representation of market microstructure, combined with the precise handling of order events,
    allows for rigorous scientific investigation into the interplay between order submission strategies and market behavior.

    \begin{figure}[htb]
        \centering
        \includegraphics[width=0.8\textwidth]{images/lob}
        \caption{Visualization of a limit order book (LOB) with buy and sell orders organized by price and time priority.}
        \label{fig:lob}
    \end{figure}

    The order book is implemented using a Red-Black tree data structure, which allows for efficient insertion, deletion, and retrieval of orders.
    Each order is represented as a node in the tree, with the price as the key and the order details (e.g., quantity, timestamp) as the value.
    New orders are sampled from a mixture of processes, and at each time step, the environment checks for order matches and executes trades accordingly,
    updating the order book and the agent's state, as well as the reward signal.

    The system dynamics are modeled as a continuous-time Markov Decision Process (MDP), where the transition probabilities
    \( P(s', t|s, a) \) are governed by the Kolmogorov forward equation:

    \[
        \frac{\partial P(s', t|s, a)}{\partial t} = \int_S L(x|s, a, t) P(s'|x, a, t) \, dx
    \]

    Here, \( a \) represents the action chosen by the control agent according to a policy \( \pi(s) \), and \( L(x|s, a, t) \) is the generator operator,
    which defines the dynamics of state transitions at any given time \( t \).
    Solving for the transition probabilities is often approached either analytically through closed-form solutions,
    as in earlier works (Avellaneda et al., 2008; Gueant et al., 2017),
    or numerically via approximations (e.g., by simulating trajectories or using reinforcement learning methods).

    The market-making problem is modeled using online reinforcement learning, where the simulator represents a
    limit order book (LOB) that reflects stylized market behaviors.
    The event timing in the LOB follows a Hawkes process, capturing the self-exciting nature of clustered order arrivals.
    The intensity \( \lambda(t) \) of the Hawkes process is defined as:

    \begin{gather*}
        \lambda(t) = \mu + \sum_{t_i < t} \phi(t - t_i)\\
        \phi(t - t_i) = \alpha e^{-\beta(t - t_i)}\\
    \end{gather*}

    where \( \mu > 0 \) is the baseline intensity, and \( \alpha \), \( \beta \) govern the magnitude and decay of past events' influence.
    To generate order arrivals, we sample from an exponential process with intensity \( \lambda(t) \),
    where the inter-arrival times are exponentially distributed.
    Bid and ask prices are modeled as separate Geometric Brownian Motion (GBM) processes, with prices evolving according to:

    \begin{gather*}
        dX_{\text{ask}} = (\mu_t + s_t) X_{\text{mid}} \, dt + \sigma dW_t\\
        dX_{\text{bid}} = (\mu_t - s_t) X_{\text{mid}} \, dt + \sigma dW_t\\
    \end{gather*}

    where \( \mu_t \) is the drift, \( s_t \) is the spread, and \( \sigma \) is the volatility.
    The drift \( \mu_t \) follows a mean-reverting Ornstein-Uhlenbeck process, while the spread \( s_t \) follows a Cox-Ingersoll-Ross process,
    ensuring a positive spread.
    The midprice \( X_{\text{mid}} \) is calculated as the average of the current bid and ask prices.
    In the absence of orders, the midprice is based on the last traded price or an initial value.

    \[
        X_{\text{mid}} = \frac{X_{\text{ask}} + X_{\text{bid}}}{2}
    \]

    Price volatility is modeled using a GARCH(1,1) process:

    \[
        \sigma_t^2 = \omega + \alpha \epsilon_{t-1}^2 + \beta \sigma_{t-1}^2
    \]

    where \( \sigma_t \) is the volatility, \( \epsilon_{t-1} \) is the return shock, and \( \alpha \), \( \beta \) are parameters capturing volatility clustering.
    Order quantities \( q_{\text{ask}} \) and \( q_{\text{bid}} \) are modeled as Poisson random variables with arrival rate \( \lambda_q \),
    reflecting stochastic order arrivals.
    All market regime variables (e.g., spread, order arrival rate, and price drift, are sampled according to the afforementioned process,
    and their mixture form the order book dynamics.


\end{document}